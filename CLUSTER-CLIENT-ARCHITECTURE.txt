â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    Redis Cluster Client Architecture
                   (Example: 3 Masters + 3 Replicas)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Legend:
  ğŸ“¦ = Actual object/instance in memory
  ğŸ‘‰ = Reference/pointer to object
  âš¡ = TCP connection to Redis server

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RedisClusterSlots ğŸ“¦
â”‚
â”œâ”€â”€â”€ slots[16384] (Array)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ slots[0-5460] ğŸ‘‰â”€â”€â”€â”€â”€â”
â”‚    â”œâ”€â”€â”€ slots[5461-10922] ğŸ‘‰â”€â”¤
â”‚    â””â”€â”€â”€ slots[10923-16383] ğŸ‘‰â”¤
â”‚                               â”‚
â”‚                               â–¼
â”‚                          Shard ğŸ“¦ (references master/replica below)
â”‚
â”œâ”€â”€â”€ masters[3] (Array)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ [0] MasterNode1 ğŸ“¦
â”‚    â”‚         â”œâ”€â”€â”€ address: "host1:6379"
â”‚    â”‚         â”œâ”€â”€â”€ client: Client1 ğŸ“¦âš¡ â†’ Redis Master 1
â”‚    â”‚         â””â”€â”€â”€ pubSub?: ğŸ“¦
â”‚    â”‚                â””â”€â”€â”€ client: PubSubClient1 ğŸ“¦âš¡ â†’ Redis Master 1
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ [1] MasterNode2 ğŸ“¦
â”‚    â”‚         â”œâ”€â”€â”€ address: "host2:6379"
â”‚    â”‚         â”œâ”€â”€â”€ client: Client2 ğŸ“¦âš¡ â†’ Redis Master 2
â”‚    â”‚         â””â”€â”€â”€ pubSub?: ğŸ“¦
â”‚    â”‚                â””â”€â”€â”€ client: PubSubClient2 ğŸ“¦âš¡ â†’ Redis Master 2
â”‚    â”‚
â”‚    â””â”€â”€â”€ [2] MasterNode3 ğŸ“¦
â”‚              â”œâ”€â”€â”€ address: "host3:6379"
â”‚              â”œâ”€â”€â”€ client: Client3 ğŸ“¦âš¡ â†’ Redis Master 3
â”‚              â””â”€â”€â”€ pubSub?: ğŸ“¦
â”‚                     â””â”€â”€â”€ client: PubSubClient3 ğŸ“¦âš¡ â†’ Redis Master 3
â”‚
â”œâ”€â”€â”€ replicas[3] (Array)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ [0] ReplicaNode1 ğŸ“¦
â”‚    â”‚         â”œâ”€â”€â”€ address: "host4:6379"
â”‚    â”‚         â””â”€â”€â”€ client: Client4 ğŸ“¦âš¡ â†’ Redis Replica 1
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ [1] ReplicaNode2 ğŸ“¦
â”‚    â”‚         â”œâ”€â”€â”€ address: "host5:6379"
â”‚    â”‚         â””â”€â”€â”€ client: Client5 ğŸ“¦âš¡ â†’ Redis Replica 2
â”‚    â”‚
â”‚    â””â”€â”€â”€ [2] ReplicaNode3 ğŸ“¦
â”‚              â”œâ”€â”€â”€ address: "host6:6379"
â”‚              â””â”€â”€â”€ client: Client6 ğŸ“¦âš¡ â†’ Redis Replica 3
â”‚
â”œâ”€â”€â”€ nodeByAddress (Map)
â”‚    â”‚
â”‚    â”œâ”€â”€â”€ "host1:6379" ğŸ‘‰ MasterNode1 (same object as masters[0])
â”‚    â”œâ”€â”€â”€ "host2:6379" ğŸ‘‰ MasterNode2 (same object as masters[1])
â”‚    â”œâ”€â”€â”€ "host3:6379" ğŸ‘‰ MasterNode3 (same object as masters[2])
â”‚    â”œâ”€â”€â”€ "host4:6379" ğŸ‘‰ ReplicaNode1 (same object as replicas[0])
â”‚    â”œâ”€â”€â”€ "host5:6379" ğŸ‘‰ ReplicaNode2 (same object as replicas[1])
â”‚    â””â”€â”€â”€ "host6:6379" ğŸ‘‰ ReplicaNode3 (same object as replicas[2])
â”‚
â””â”€â”€â”€ pubSubNode? (optional) ğŸ“¦
         â”œâ”€â”€â”€ address: "host2:6379" (randomly selected)
         â””â”€â”€â”€ client: PubSubClient7 ğŸ“¦âš¡ â†’ Redis Master/Replica (any)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              CLIENT COUNT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Regular Clients (always created at connect):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Client1 ğŸ“¦âš¡  â†’ Master 1 (host1:6379)   â”‚
  â”‚ Client2 ğŸ“¦âš¡  â†’ Master 2 (host2:6379)   â”‚
  â”‚ Client3 ğŸ“¦âš¡  â†’ Master 3 (host3:6379)   â”‚
  â”‚ Client4 ğŸ“¦âš¡  â†’ Replica 1 (host4:6379)  â”‚
  â”‚ Client5 ğŸ“¦âš¡  â†’ Replica 2 (host5:6379)  â”‚
  â”‚ Client6 ğŸ“¦âš¡  â†’ Replica 3 (host6:6379)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Total: 6 TCP connections âš¡

PubSub Clients (created on-demand):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ PubSubClient1 ğŸ“¦âš¡ â†’ Master 1 (sharded pub/sub, SSUBSCRIBE)    â”‚
  â”‚ PubSubClient2 ğŸ“¦âš¡ â†’ Master 2 (sharded pub/sub, SSUBSCRIBE)    â”‚
  â”‚ PubSubClient3 ğŸ“¦âš¡ â†’ Master 3 (sharded pub/sub, SSUBSCRIBE)    â”‚
  â”‚ PubSubClient7 ğŸ“¦âš¡ â†’ Any node (regular pub/sub, SUBSCRIBE)     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Total: up to 4 TCP connections âš¡

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GRAND TOTAL: 6-10 TCP connections depending on pub/sub usage
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          HOW CLIENTS ARE USED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Regular Commands (GET, SET, HGET, etc.)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Calculate slot: slot = hash(key) % 16384                  â”‚
   â”‚ â€¢ Lookup: shard = slots[slot]                               â”‚
   â”‚ â€¢ For writes: use shard.master.client                       â”‚
   â”‚ â€¢ For reads: use shard.master.client OR shard.replicas[].client â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Sharded Pub/Sub (SSUBSCRIBE, SPUBLISH) - Redis 7.0+
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Calculate slot: slot = hash(channel) % 16384              â”‚
   â”‚ â€¢ Lookup: shard = slots[slot]                               â”‚
   â”‚ â€¢ Use: shard.master.pubSub.client                           â”‚
   â”‚ â€¢ Each master has its own dedicated sharded pub/sub client  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Regular Pub/Sub (SUBSCRIBE, PSUBSCRIBE)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Use: pubSubNode.client                                    â”‚
   â”‚ â€¢ Single shared client for all non-sharded pub/sub          â”‚
   â”‚ â€¢ Can be any master or replica (randomly selected)          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Node Lookup by Address
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Use: nodeByAddress.get("host:port")                       â”‚
   â”‚ â€¢ Returns reference to master/replica node                  â”‚
   â”‚ â€¢ Useful for handling redirects (MOVED/ASK responses)       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                          KEY INSIGHTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ NO DUPLICATE NODE OBJECTS
  All arrays and maps reference the same Node ğŸ“¦ objects. There are exactly
  6 node objects (3 masters + 3 replicas), not 18 or 24.

âœ“ SEPARATE CLIENTS FOR PUB/SUB
  Pub/sub requires dedicated clients because once a Redis client enters
  pub/sub mode, it can only execute pub/sub commands. Regular commands
  cannot share the same connection.

âœ“ LAZY CREATION
  Pub/sub clients are only created when first needed (on-demand), not at
  cluster connection time.

âœ“ EFFICIENT ROUTING
  - slots[] = Fast O(1) slot-to-shard lookup for commands
  - masters[] = Iterate all masters
  - replicas[] = Iterate all replicas  
  - nodeByAddress = Fast O(1) address-to-node lookup for redirects
